<!DOCTYPE HTML>
<!--
	Editorial by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
        <title>OOP concepts in Python 2.x - Part 3 - The Digital Cat</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,400italic,600italic|Roboto+Slab:400,700">

        <link rel="stylesheet" href="/theme/css/main.min.css?95cd4e15">

        
        <link href="/images/global/favicon.jpg" rel="icon">

        <!-- Google Analytics Universal -->
        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-74364524-1', 'auto');
            ga('send', 'pageview');
        </script>
        <!-- End Google Analytics Universal Code -->

<script type="application/ld+json">
{
  "@context" : "https://schema.org",
  "@type" : "Article",
  "name" : "OOP concepts in Python 2.x - Part 3",
  "author" : {
    "@type" : "Person",
    "name" : "Leonardo Giordani"
  },
  "publisher" : {
    "@type" : "Organization",
    "name" : "The Digital Cat",
    "logo" : {
      "@type" : "ImageObject",
      "url" : "https://www.thedigitalcatonline.com/images/global/logo_200.jpg",
      "height" : 200,
      "width" : 200
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.thedigitalcatonline.com/blog/2014/07/04/oop-concepts-in-python-2-dot-x-part-3/"
  },
  "datePublished" : "04/07/2014",
  "dateModified" : "04/07/2014",
  "image" : "https://www.thedigitalcatonline.com/images/oop-concepts-in-python-2-dot-x.jpg",
  "url" : "https://www.thedigitalcatonline.com/blog/2014/07/04/oop-concepts-in-python-2-dot-x-part-3/"
}
</script>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">
						<div class="inner">

    <header id="header">
        <a class="logo" href="/category/programming/" title="Programming">All posts in category Programming <i class="fa fa-link"></i></a>
        <div class="align-right">
            
            <a href="/blog/2014/03/10/oop-concepts-in-python-2-dot-x-part-2/"><i class="fa fa-caret-square-left"></i></a>
            
            OOP concepts in Python 2.x #3


        </div>
    </header>

    <!-- <article class="post"> -->

    <section id="header">
        <header class="main">
            <h1>OOP concepts in Python 2.x - Part 3</h1>
        </header>
    </section>

    <section id="post-info">
        <div class="align-center">
            <a class="button small" href="/categories/python2/">Python2</a>            <a class="button small" href="/categories/python/">Python</a>            <a class="button small" href="/categories/oop/">OOP</a>        </div>

        <div class="align-center">
            By Leonardo Giordani
            <span class="separator">â€¢</span>

            Published on <time datetime="2014-07-04T13:00:00+02:00"> 04/07/2014</time>

        </div>
    </section>

    <section id="content">
        <h2 id="abstract">Abstract<a class="headerlink" href="#abstract" title="Permanent link">&para;</a></h2>
<p>Welcome to the third installment of this little series of posts about Python 2.x OOP implementation. The <a href="https://www.thedigitalcatonline.com/blog/2014/03/05/oop-concepts-in-python-2-dot-x-part-1/">first</a> and <a href="https://www.thedigitalcatonline.com/blog/2014/03/10/oop-concepts-in-python-2-dot-x-part-2/">second</a> issues introduced the most important concepts at the basis of Python as an object-oriented language.</p>
<p>This post will continue the discussion about metaclasses, introducing Abstract Base Classes, and give some insights on callable objects.</p>
<p>This post refers to the internals of Python 2.x - please note that Python 3.x changes (improves!) some of the features shown here. You can find the <strong>updated version</strong> <a href="/categories/python3/">here</a>.</p>
<h2 id="the-inspection-club">The Inspection Club<a class="headerlink" href="#the-inspection-club" title="Permanent link">&para;</a></h2>
<p>As you know, Python leverages polymorphism at its maximum by dealing only with generic references to objects. This makes OOP not an addition to the language but part of its structure from the ground up. Moreover, Python pushes the EAFP appoach, which tries to avoid direct inspection of objects as much as possible.</p>
<p>It is however very interesting to read what Guido van Rossum says in <a href="http://legacy.python.org/dev/peps/pep-3119/">PEP 3119</a>: <em>Invocation means interacting with an object by invoking its methods. Usually this is combined with polymorphism, so that invoking a given method may run different code depending on the type of an object. Inspection means the ability for external code (outside of the object's methods) to examine the type or properties of that object, and make decisions on how to treat that object based on that information. [...] In classical OOP theory, invocation is the preferred usage pattern, and inspection is actively discouraged, being considered a relic of an earlier, procedural programming style. However, in practice this view is simply too dogmatic and inflexible, and leads to a kind of design rigidity that is very much at odds with the dynamic nature of a language like Python.</em></p>
<p>The author of Python recognizes that forcing the use of a pure polymorphic approach leads sometimes to solutions that are too complex or even incorrect. In this section I want to show some of the problems that can arise from a pure polymorphic approach and introduce Abstract Base Classes, which aim to solve them. I strongly suggest to read <a href="http://legacy.python.org/dev/peps/pep-3119/">PEP 3119</a> (as for any other PEP) since it contains a deeper and better explanation of the whole matter. Indeed I think that this PEP is so well written that any further explanation is hardly needed. I am however used to write explanations to check how much I understood about the topic, so I am going to try it this time too.</p>
<h4 id="eafp-the-extra-test-trial">E.A.F.P the Extra Test Trial<a class="headerlink" href="#eafp-the-extra-test-trial" title="Permanent link">&para;</a></h4>
<p>The EAFP coding style requires you to trust the incoming objects to provide the attributes and methods you need, and to manage the possible exceptions, if you know how to do it. Sometimes, however, you need to test if the incoming object matches a complex behaviour. For example, you could be interested in testing if the object <em>acts</em> like a list, but you quickly realize that the amount of methods a <code>list</code> provides is very big and this could lead to odd EAFP code like</p>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">append</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">count</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">extend</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">index</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">insert</span>
    <span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
    <span class="p">[</span><span class="o">...</span><span class="p">]</span>
</pre></div>


<p>where the methods of the <code>list</code> type are accessed (not called) just to force the object to raise the <code>AttributeError</code> exception if they are not present. This code, however, is not only ugly but also wrong. If you recall the "Enter the Composition" section of the <a href="https://www.thedigitalcatonline.com/blog/2014/03/05/oop-concepts-in-python-2-dot-x-part-1/">first post</a>, you know that in Python you can always customize the <code>__getattr__()</code> method, which is called whenever the requested attribute is not found in the object. So I could write a class that passes the test but actually does not act like a list</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FakeList</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">fakemethod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;extend&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;insert&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fakemethod</span>
</pre></div>


<p>This is obviously just an example, and no one will ever write such a class, but this demonstrates that just accessing methods does not guarantee that a class <em>acts</em> like the one we are expecting.</p>
<p>There are many examples that could be done leveraging the highly dynamic nature of Python and its rich object model. I would summarize them by saying that sometimes you'd better to check the type of the incoming object.</p>
<p>In Python you can obtain the type of an object using the <code>type()</code> built-in function, but to check it you'd better use <code>isinstance()</code>, which returns a boolean value. Let us see an example before moving on</p>
<div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">([],</span> <span class="nb">list</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Door</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">... </span> <span class="k">pass</span>
<span class="gp">... </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Door</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">Door</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">EnhancedDoor</span><span class="p">(</span><span class="n">Door</span><span class="p">):</span>
<span class="gp">... </span> <span class="k">pass</span>
<span class="gp">... </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ed</span> <span class="o">=</span> <span class="n">EnhancedDoor</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ed</span><span class="p">,</span> <span class="n">EnhancedDoor</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ed</span><span class="p">,</span> <span class="n">Door</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>


<p>As you can see the function can also walk the class hierarchy, so the check is not so trivial like the one you would obtain by directly using <code>type()</code>.</p>
<p>The <code>isinstance()</code> function, however, does not completely solve the problem. If we write a class that actually <em>acts</em> like a <code>list</code> but does not inherit from it, <code>isinstance()</code> does not recognize the fact that the two may be considered the same thing. The following code returns <code>False</code> regardless the content of the <code>MyList</code> class</p>
<div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyList</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">... </span> <span class="k">pass</span>
<span class="gp">... </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ml</span> <span class="o">=</span> <span class="n">MyList</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ml</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>


<p>since <code>isinstance()</code> does not check the content of the class or its behaviour, it just consider the class and its ancestors.</p>
<p>The problem, thus, may be summed up with the following question: what is the best way to test that an object exposes a given interface? Here, the word <em>interface</em> is used for its natural meaning, without any reference to other programming solutions, which however address the same problem.</p>
<p>A good way to address the problem could be to write inside an attribute of the object the list of interfaces it promises to implement, and to agree that any time we want to test the behaviour of an object we simply have to check the content of this attribute. This is exactly the path followed by Python, and it is very important to understand that the whole system is just about a promised behaviour.</p>
<p>The solution proposed through PEP 3119 is, in my opinion, very simple and elegant, and it perfectly fits the nature of Python, where things are usually agreed rather than being enforced. Not only, the solution follows the spirit of polymorphism, where information is provided by the object itself and not extracted by the calling code.</p>
<p>In the next sections I am going to try and describe this solution in its main building blocks. The matter is complex so my explanation will lack some details: please refer to the forementioned PEP 3119 for a complete description.</p>
<h4 id="who-framed-the-metaclasses">Who Framed the Metaclasses<a class="headerlink" href="#who-framed-the-metaclasses" title="Permanent link">&para;</a></h4>
<p>As already described, Python provides two built-ins to inspect objects and classes, which are <code>isinstance()</code> and <code>issubclass()</code> and it would be desirable that a solution to the inspection problem allows the programmer to go on with using those two functions.</p>
<p>This means that we need to find a way to inject the "behaviour promise" into both classes and instances. This is the reason why metaclasses come in play. If you recall what we said about them in the second issue of this series, metaclasses are the classes used to build classes, which means that they are the preferred way to change the structure of a class, and, in consequence, of its instances.</p>
<p>Another way to do the same job would be to leverage the inheritance mechanism, injecting the behaviour through a dedicated parent class. This solution has many downsides, which I'm am not going to detail. It is enough to say that affecting the class hierarchy may lead to complex situations or subtle bugs. Metaclasses may provide here a different entry point for the introduction of a "virtual base class" (as PEP 3119 specifies, this is not the same concept as in C++).</p>
<h4 id="overriding-places">Overriding Places<a class="headerlink" href="#overriding-places" title="Permanent link">&para;</a></h4>
<p>As said, <code>isinstance()</code> and <code>issubclass()</code> are built-in functions, not object methods, so we cannot simply override them providing a different implementation in a given class. So the first part of the solution is to change the behaviour of those two functions to first check if the class or the instance contain a special method, which is <code>__instancecheck__()</code> for <code>isinstance()</code> and <code>__subclasscheck__()</code> for <code>issubclass()</code>. So both built-ins try to run the respective special method, reverting to the standard algorithm if it is not present.</p>
<p>A note about naming. Methods must accept the object they belong to as the first argument, so the two special methods shall have the form</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">inst</span><span class="p">):</span>
   <span class="p">[</span><span class="o">...</span><span class="p">]</span>

<span class="k">def</span> <span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">sub</span><span class="p">):</span>
   <span class="p">[</span><span class="o">...</span><span class="p">]</span>
</pre></div>


<p>where <code>cls</code> is the class where they are injected, that is the one representing the promised behaviour. The two built-ins, however, have a reversed argument order, where the behaviour comes after the tested object: when you write <code>isinstance([], list)</code> you want to check if the <code>[]</code> instance has the <code>list</code> behaviour. This is the reason behind the name choice: just calling the methods <code>__isinstance__()</code> and <code>__issubclass__()</code> and passing arguments in a reversed order would have been confusing.</p>
<h4 id="this-is-abc">This is ABC<a class="headerlink" href="#this-is-abc" title="Permanent link">&para;</a></h4>
<p>The proposed solution is thus called Abstract Base Classes, as it provides a way to attach to a concrete class a virtual class with the only purpose of signaling a promised behaviour to anyone inspecting it with <code>isinstance()</code> or <code>issubclass()</code>.</p>
<p>To help programmers implement Abstract Base Classes, the standard library has been given an <code>abc</code> module, thet contains the <code>ABCMeta</code> class (and other facilities). This class is the one that implements <code>__instancecheck__()</code> and <code>__subclasscheck__()</code> and shall be used as a metaclass to augment a standard class. The latter will then be able to register other classes as implementation of its behaviour.</p>
<p>Sounds complex? An example may clarify the whole matter. The one from the official documentation is rather simple:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span>

<span class="k">class</span> <span class="nc">MyABC</span><span class="p">:</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>

<span class="n">MyABC</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">tuple</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">MyABC</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">((),</span> <span class="n">MyABC</span><span class="p">)</span>
</pre></div>


<p>Here, the <code>MyABC</code> class is provided the <code>ABCMeta</code> metaclass. This puts the two <code>__instancecheck__()</code> and <code>__subclasscheck__()</code> behaviours inside <code>MyABC</code>. Please note however that those methods are not actually put into the object so that you can use them like</p>
<div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">MyABC</span><span class="o">.</span><span class="n">__metaclass__</span><span class="o">.</span><span class="fm">__instancecheck__</span><span class="p">(</span><span class="n">MyABC</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
</pre></div>


<p>that returns <code>True</code> if the dictionary <code>d</code> is an instance of the Abstract Base Class <code>MyABC</code>. In other words if the dictionary <code>d</code> implements the behaviour promised by the <code>MyABC</code> class.</p>
<p>After the definition of <code>MyABC</code> we need a way to signal that a given class is an instance of the Abstract Base Class and this happens through the <code>register()</code> method, provided by the <code>ABCMeta</code> metaclass. Calling <code>MyABC.register(tuple)</code> we record inside <code>MyABC</code> the fact that the <code>tuple</code> class shall be identified as a subclass of <code>MyABC</code> itself. This is analogous to saying that <code>tuple</code> inherits from <code>MyABC</code> but not quite the same. As already said registering a class in an Abstract Base Class with <code>register()</code> does not affect the class hierarchy. Indeed, the whole <code>tuple</code> class is unchanged.</p>
<h2 id="little-shop-of-collections">Little Shop of Collections<a class="headerlink" href="#little-shop-of-collections" title="Permanent link">&para;</a></h2>
<p>In addition to the <code>abc</code> module, the standard library now provides a <code>collections</code> module that, besides some interesting container datatypes like <code>namedtuple</code> and <code>OrderedDict</code>, supplies a remarkable number of ABCs that represent container behaviours. An example is <code>collections.Sized</code> that pledges that the registered class will contain the <code>__len__()</code> method, enabling the code to pass it to the <code>len()</code> builtin. Let us exemplify that:</p>
<div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Snake</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meters</span><span class="p">):</span>
<span class="gp">... </span>    <span class="bp">self</span><span class="o">.</span><span class="n">len</span> <span class="o">=</span> <span class="n">meters</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">len</span>
<span class="gp">... </span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Snake</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">collections</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collections</span><span class="o">.</span><span class="n">Sized</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Snake</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">issubclass</span><span class="p">(</span><span class="n">Snake</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Sized</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>


<p>If not stressed enough, ABCs assure that a given behaviour will be implemented but there is no actual check of this. For example:</p>
<div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">FakeSnake</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meters</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">... </span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collections</span><span class="o">.</span><span class="n">Sized</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">FakeSnake</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">issubclass</span><span class="p">(</span><span class="n">FakeSnake</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Sized</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">FakeSnake</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="go">Traceback  (most recent call last):</span>
<span class="go">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="go">TypeError: object of type &#39;FakeSnake&#39; has no len()</span>
</pre></div>


<p>Remember that ABCs are classes just like any other standard Python class, which means that they can be inherited to build more specialized ABCs.</p>
<h4 id="the-naked-class">The Naked Class<a class="headerlink" href="#the-naked-class" title="Permanent link">&para;</a></h4>
<p>The <code>abc</code> module provides two decorators <code>@abstractmethod</code> and <code>@abstractproperty</code> to help the design of Abstract Base Classes. The first decorator, <code>@abstractmethod</code>, may only be used in a class which metaclass is <code>ABCMeta</code> (just like the example <code>MyABC</code> class described above). Decorating a method with it blocks the instantiation of the class itself until that method is overridden. That enables to write classes that may inherited only if the child class provides an implementation of some specific methods. The <code>@abstractproperty</code> decorator provides the same service for properties.</p>
<p>Let us run through a very simple example:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">abc</span>

<span class="k">class</span> <span class="nc">AbstractCalculator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">mutiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>


<p>This is a class with <code>ABCMeta</code> as its metaclass, which makes <code>AbstractCalculator</code> an Abstract Base Class. The two <code>sum()</code> and <code>multiply()</code> methods are decorated with <code>@abstractmethod</code>, that raises an exception when we try to instance the class:</p>
<div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ac</span> <span class="o">=</span> <span class="n">AbstractCalculator</span><span class="p">()</span>
<span class="go">Traceback  (most recent call last):</span>
<span class="go">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="go">TypeError: Can&#39;t instantiate abstract class AbstractCalculator with abstract methods mutiply, sum</span>
<span class="gp">&gt;&gt;&gt; </span>
</pre></div>


<p>Moreover, any class that derives from <code>AbstractCalculator</code> and does not override the two methods (implementing them), cannot be instantiated:</p>
<div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Calculator</span><span class="p">(</span><span class="n">AbstractCalculator</span><span class="p">):</span>
<span class="gp">... </span> <span class="k">pass</span>
<span class="gp">... </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">Calculator</span><span class="p">()</span>
<span class="go">Traceback  (most recent call last):</span>
<span class="go">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="go">TypeError: Can&#39;t instantiate abstract class Calculator with abstract methods mutiply, sum</span>
<span class="gp">&gt;&gt;&gt; </span>
</pre></div>


<p>These two decorators are the standard way to enforce a check about a behaviour or an interface, and are the closest thing to a "strict interface check".</p>
<h2 id="a-fish-called-object">A Fish Called Object<a class="headerlink" href="#a-fish-called-object" title="Permanent link">&para;</a></h2>
<p>In the first post, when I discussed for the first time the concept of instantiation, I stated that an instance of a class may be obtained by calling the class itself just like a function. Let me recall you the example</p>
<div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">&lt;type &#39;int&#39;&gt;</span>
</pre></div>


<p>Later, speaking about methods and attributes, I defined <em>callable</em> something that can be invoked with that syntax. Thus, we can now say that classes are callables, just like methods. What makes an object callable, anyway? It turns out that, as many other things in Python, the solution is pretty straightforward: an object is callable if it contains the <code>__call__()</code> method. Simple, isn't it?</p>
<p>When we execute a syntax like</p>
<div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">some_object</span><span class="p">()</span>
</pre></div>


<p>Python executes under the hood the following code</p>
<div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">some_object</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span>
</pre></div>


<p>where any parameter passed to the class is obviously passed to <code>__call__()</code>.</p>
<p>For standard classes the <code>__call__()</code> method is provided by <code>type</code>, which is the standard metaclass. So when we write</p>
<div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">()</span>
</pre></div>


<p>python actually executes this code</p>
<div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>


<p>This standard implementation of <code>__call__()</code> runs the constructor mechanism as depicted in the second post, executing <code>__new__()</code> and <code>__init__()</code> to get a new instance and initialize it. </p>
<p>The definition of callable object is very powerful, since it allows to flatten the difference between classes and functions. In OOP many times the two are presented as two completely separated concepts, but in Python it is usually more convenient to talk about callables. Here, Python shows its polymorphic nature at its maximum: if I expect a function and what is given to me is something that acts like a function everything is fine. Functions, however, are themselves simple callable objects. Remember: in Python everything is an object.</p>
<p>Since <code>__call__()</code> is a method we can redefine it in any class, let us try and see what happens</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CallMe</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span>
</pre></div>


<p>Class instances usually contain no definition of <code>__call__()</code> and the implementation provided in the class hierarchy prevents them from being called</p>
<div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="nb">int</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">()</span>
<span class="go">Traceback  (most recent call last):</span>
<span class="go">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="go">TypeError: &#39;int&#39; object is not callable</span>
</pre></div>


<p>Nothing forbids us to define a custom <code>__call__()</code> method inside the instance and make it callable. This allows us to pass the instance where Python expects a function or, better, a callable. A classical example is the <code>sort()</code> method of <code>list</code> objects, which accepts an optional callable <code>f</code> that shall compare objects. Here, a callable instance is accepted just like a plain function.</p>
<h2 id="final-words">Final words<a class="headerlink" href="#final-words" title="Permanent link">&para;</a></h2>
<p>There is still a lot to say about Python OOP. Just to name one topic, functions are a very interesting and wide subject. I would prefer now to update the current material to Python 3, so this is the last post in this small series. Stay tuned <a href="https://twitter.com/thedigicat/">on Twitter</a> if you want to get the latest news from the blog!</p>
<h2 id="movie-trivia">Movie Trivia<a class="headerlink" href="#movie-trivia" title="Permanent link">&para;</a></h2>
<p>Section titles of this issue come from the following movies: <em>The Breakfast Club</em>, <em>E.T. the Extra-Terrestrial</em>, <em>Who Framed Roger Rabbit</em>, <em>Trading Places</em>, <em>This is Spinal Tap</em>, <em>Little Shop of Horrors</em>, <em>The Naked Gun</em>, <em>A Fish Called Wanda</em>.</p>
<h2 id="sources">Sources<a class="headerlink" href="#sources" title="Permanent link">&para;</a></h2>
<p>Some sources for the content of this post. Thank you authors!</p>
<ul>
<li><a href="http://legacy.python.org/dev/peps/pep-3119/">PEP 3119</a> and the <a href="https://docs.python.org/2/library/abc.html#module-abc">ABC module documentation</a></li>
<li><a href="http://www.jeffknupp.com/blog/2013/02/14/drastically-improve-your-python-understanding-pythons-execution-model/">Understanding Python's Execution Model</a> and <a href="http://jeffknupp.com/blog/2014/06/18/improve-your-python-python-classes-and-object-oriented-programming/">Python Classes and Object Oriented Programming</a> by Jeff Knupp</li>
<li><a href="http://www.rafekettler.com/magicmethods.html">A Guide to Python's Magic Methods</a> by Rafe Kettler</li>
<li>Many <a href="https://stackoverflow.com/questions/tagged/python">Stackoverflow</a> questions and answers</li>
</ul>
<h2 id="feedback">Feedback<a class="headerlink" href="#feedback" title="Permanent link">&para;</a></h2>
<p>The <a href="https://github.com/TheDigitalCatOnline/thedigitalcatonline.github.com/issues">GitHub issues</a> page is the best place to submit corrections.</p>
    </section>

    <section id="related">

        <h1>Part 3 of the OOP concepts in Python 2.x series</h1>
        <div class="box">
            <h5>Previous articles</h5>
            <ul>
                <li><a href="/blog/2014/03/05/oop-concepts-in-python-2-dot-x-part-1/">OOP concepts in Python 2.x - Part 1</a></li>
                <li><a href="/blog/2014/03/10/oop-concepts-in-python-2-dot-x-part-2/">OOP concepts in Python 2.x - Part 2</a></li>
            </ul>
        
        </div>
    </section>



    <!-- </article> -->

						</div>
					</div>

				<!-- Sidebar -->
					<div id="sidebar">
<div class="inner">
    <!-- Menu -->
        <nav id="menu">
            <header class="major">
                <h2>Menu</h2>
            </header>
<ul>
    <li><a href="/index.html">Homepage</a></li>
    <li><a href="/pages/about.html">About</a></li>
    <li><a href="/archives/index.html">Archives</a></li>
    <li>
        <span class="opener">Categories</span>
        <ul>
            <li><a href="/category/programming/">Programming</a></li>
            <li><a href="/category/projects/">Projects</a></li>
            <li><a href="/category/retro/">Retro</a></li>
        </ul>
    </li>
</ul>        </nav>

    <!-- Section -->
        <section>
            <header class="major">
                <h2>Feeds</h2>
            </header>
<ul class="list-clean">
    <li><a href="/atom.xml"><i class="fa fa-rss"></i> All posts</a></li>


    <li><a href="/category/programming/atom.xml"><i class="fa fa-rss"></i> All posts in category: Programming</a></li>
</ul>        </section>

    <!-- Section -->
        <section>
            <header class="major">
                <h2>Tags</h2>
            </header>
<ul class="list-inline list-clean" id="tags-side">
    <li class="tag font-size-3">
        <a href="/categories/algorithms/">algorithms</a>
    </li>
    <li class="tag font-size-2">
        <a href="/categories/amiga/">amiga</a>
    </li>
    <li class="tag font-size-4">
        <a href="/categories/amqp/">AMQP</a>
    </li>
    <li class="tag font-size-3">
        <a href="/categories/architectures/">architectures</a>
    </li>
    <li class="tag font-size-2">
        <a href="/categories/assembly/">assembly</a>
    </li>
    <li class="tag font-size-4">
        <a href="/categories/aws/">AWS</a>
    </li>
    <li class="tag font-size-2">
        <a href="/categories/c/">C</a>
    </li>
    <li class="tag font-size-4">
        <a href="/categories/clojure/">Clojure</a>
    </li>
    <li class="tag font-size-2">
        <a href="/categories/compilers/">compilers</a>
    </li>
    <li class="tag font-size-2">
        <a href="/categories/concurrent-programming/">concurrent programming</a>
    </li>
    <li class="tag font-size-3">
        <a href="/categories/cryptography/">cryptography</a>
    </li>
    <li class="tag font-size-2">
        <a href="/categories/decorators/">decorators</a>
    </li>
    <li class="tag font-size-2">
        <a href="/categories/django/">Django</a>
    </li>
    <li class="tag font-size-3">
        <a href="/categories/erlang/">Erlang</a>
    </li>
    <li class="tag font-size-4">
        <a href="/categories/flask/">Flask</a>
    </li>
    <li class="tag font-size-1">
        <a href="/categories/functional-programming/">functional programming</a>
    </li>
    <li class="tag font-size-3">
        <a href="/categories/generators/">generators</a>
    </li>
    <li class="tag font-size-3">
        <a href="/categories/git/">Git</a>
    </li>
    <li class="tag font-size-4">
        <a href="/categories/http/">HTTP</a>
    </li>
    <li class="tag font-size-4">
        <a href="/categories/infrastructure/">infrastructure</a>
    </li>
    <li class="tag font-size-4">
        <a href="/categories/m68000/">M68000</a>
    </li>
    <li class="tag font-size-2">
        <a href="/categories/metaclasses/">metaclasses</a>
    </li>
    <li class="tag font-size-2">
        <a href="/categories/metaprogramming/">metaprogramming</a>
    </li>
    <li class="tag font-size-3">
        <a href="/categories/notebook/">Notebook</a>
    </li>
    <li class="tag font-size-1">
        <a href="/categories/oop/">OOP</a>
    </li>
    <li class="tag font-size-2">
        <a href="/categories/operating-systems/">operating systems</a>
    </li>
    <li class="tag font-size-4">
        <a href="/categories/pelican/">pelican</a>
    </li>
    <li class="tag font-size-4">
        <a href="/categories/pika/">Pika</a>
    </li>
    <li class="tag font-size-4">
        <a href="/categories/postage/">Postage</a>
    </li>
    <li class="tag font-size-1">
        <a href="/categories/python/">Python</a>
    </li>
    <li class="tag font-size-2">
        <a href="/categories/python2/">Python2</a>
    </li>
    <li class="tag font-size-1">
        <a href="/categories/python3/">Python3</a>
    </li>
    <li class="tag font-size-3">
        <a href="/categories/rabbitmq/">RabbitMQ</a>
    </li>
    <li class="tag font-size-4">
        <a href="/categories/refactoring/">refactoring</a>
    </li>
    <li class="tag font-size-2">
        <a href="/categories/retroprogramming/">retroprogramming</a>
    </li>
    <li class="tag font-size-4">
        <a href="/categories/rsa/">RSA</a>
    </li>
    <li class="tag font-size-1">
        <a href="/categories/scala/">Scala</a>
    </li>
    <li class="tag font-size-4">
        <a href="/categories/ssh/">SSH</a>
    </li>
    <li class="tag font-size-3">
        <a href="/categories/ssl/">SSL</a>
    </li>
    <li class="tag font-size-1">
        <a href="/categories/tdd/">TDD</a>
    </li>
    <li class="tag font-size-1">
        <a href="/categories/testing/">testing</a>
    </li>
    <li class="tag font-size-3">
        <a href="/categories/versioning/">versioning</a>
    </li>
    <li class="tag font-size-4">
        <a href="/categories/video/">video</a>
    </li>
    <li class="tag font-size-4">
        <a href="/categories/www/">WWW</a>
    </li>
</ul>        </section>

    <!-- Section -->
        <section>
            <header class="major">
                <h2>Other posts</h2>
            </header>
<div class="mini-posts">
    <article>
        <a href="/blog/2018/12/20/cabook/" class="image"><img src="/images/cabook.jpg" alt="cabook" /></a>
        <p><strong>Clean Architectures in Python: the book</strong> <a href="/blog/2018/12/20/cabook/">Read</a></p> 
    </article>
    <article>
        <a href="/blog/2016/11/14/clean-architectures-in-python-a-step-by-step-example/" class="image"><img src="/images/clean-architectures.jpg" alt="clean-architectures" /></a>
        <p><strong>Clean architectures in Python: a step-by-step example</strong> <a href="/blog/2016/11/14/clean-architectures-in-python-a-step-by-step-example/">Read</a></p> 
    </article>
    <article>
        <a href="/blog/2016/09/27/python-mocks-a-gentle-introduction-part-2/" class="image"><img src="/images/python-mocks.jpg" alt="python-mocks" /></a>
        <p><strong>Python Mocks: a gentle introduction - Part 2</strong> <a href="/blog/2016/09/27/python-mocks-a-gentle-introduction-part-2/">Read</a></p> 
    </article>
</div>        </section>

    <!-- Section -->
        <section>
            <header class="major">
                <h2>Get in touch</h2>
            </header>
<ul class="contact">
    
    
    
    <li class="fa-twitter"><a href="https://twitter.com/thedigicat">Twitter</a></li>
    
    
    
    
    <li class="fa-github"><a href="https://github.com/TheDigitalCatOnline">GitHub</a></li>
    
</ul>        </section>

    <!-- Footer -->
        <footer id="footer">
            <p class="copyright">Editorial theme by: <a href="https://html5up.net">HTML5 UP</a>.</p>
            <p class="copyright">Cover picture by: <a href="https://pxhere.com/en/photo/1428515">An Min @ pxhere.com</a></p>
        </footer>

</div>					</div>

			</div>

		<!-- Scripts -->
			<script src="/theme/js/jquery.min.js"></script>
			<script src="/theme/js/browser.min.js"></script>
			<script src="/theme/js/breakpoints.min.js"></script>
            <script src="/theme/js/packed.js?fa89ff81"></script>

	</body>
</html>